{% extends 'base.html' %}

{% load static %}

{% block content %}

<link rel="stylesheet" href="{% static 'js/cust.js' %}">
<link rel="stylesheet" href="{% static 'css' %}">

<style>
   

/* General Table Styling */
.shop__cart__table table {
    width: 100%;
    border-collapse: collapse;
}

.shop__cart__table th,
.shop__cart__table td {
    padding: 15px;
    text-align: center;
    border-bottom: 1px solid #ebe1e1;
    font-weight: 500;
}

.shop__cart__table th {
    background-color: #f7f7f7;
    color: #333;
}

/* Product Image Styling */
.cart__product__item img {
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Product Title Styling */
.cart__product__item__title h6 {
    font-size: 16px;
    font-weight: 600;
    color: #333;
}

/* Badge Styling */
.badge {
    font-size: 12px;
    padding: 5px 10px;
    font-weight: 600;
}

/* Quantity Input Styling */
.value-button {
    background-color: #f0f0f0;
    border: 1px solid #ddd;
    padding: 5px 10px;
    cursor: pointer;
}

.prod_quantity {
    font-size: 16px;
    font-weight: 500;
}

/* Total Price Styling */


/* Cart Summary Styling */
.cart__total__procced h6 {
    font-size: 20px;
    font-weight: 700;
    color: #333;
    margin-bottom: 20px;
}

.cart__total__procced ul {
    list-style: none;
    padding: 0;
}

.cart__total__procced ul li {
    font-size: 16px;
    font-weight: 500;
    margin-bottom: 15px;
}

.cart__total__procced ul li span {
    float: right;
    font-weight: 600;
    color: #ca1515;
}

.btn.primary-btn {
    background-color: #ca1515;
    color: #fff;
    padding: 10px 20px;
    border-radius: 5px;
    display: inline-block;
    font-size: 16px;
    font-weight: 600;
    transition: background-color 0.3s;
}

.btn.primary-btn:hover {
    background-color: #a01212;
    text-decoration: none;
}

/* Empty Cart Message Styling */
.empty-cart-message {
    text-align: center;
    font-size: 20px;
    color: #333;
    font-weight: 600;
    margin: 50px 0;
}

/* Additional Customizations */
.icon_close {
    font-size: 20px;
    color: #ca1515;
    cursor: pointer;
}

.icon_close:hover {
    color: #a01212;
}

.discount__content {
    display: flex;
    justify-content: center;
    align-items: center;
}

.cart__btn a {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    text-decoration: none;
    transition: color 0.3s;
}

.cart__btn a:hover {
    color: #ca1515;
}

.update__btn a {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    text-decoration: none;
    transition: color 0.3s;
}

.update__btn a:hover {
    color: #ca1515;
}

/* General Table Styling */
.shop__cart__table table {
    width: 100%;
    border-collapse: collapse;
}

.shop__cart__table th,
.shop__cart__table td {
    padding: 15px;
    text-align: center;
    border-bottom: 1px solid #f0f0f0;
    font-weight: 500;
}

.shop__cart__table th {
    background-color: #f7f7f7;
    color: #333;
}

/* Product Image Styling */
.cart__product__item img {
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Product Title Styling */
.cart__product__item__title h6 {
    font-size: 16px;
    font-weight: 600;
    color: #333;
}

/* Badge Styling */
.badge {
    font-size: 12px;
    padding: 5px 10px;
    font-weight: 600;
}

/* Quantity Input Styling */
.value-button {
    background-color: #f0f0f0;
    border: 1px solid #ddd;
    padding: 5px 10px;
    cursor: pointer;
}

.prod_quantity {
    font-size: 16px;
    font-weight: 500;
}


/* Cart Summary Styling */
.cart__total__procced h6 {
    font-size: 20px;
    font-weight: 700;
    color: #333;
    margin-bottom: 20px;
}

.cart__total__procced ul {
    list-style: none;
    padding: 0;
}

.cart__total__procced ul li {
    font-size: 16px;
    font-weight: 500;
    margin-bottom: 15px;
}

.cart__total__procced ul li span {
    float: right;
    font-weight: 600;
    color: #ca1515;
}

.btn.primary-btn {
    background-color: #ca1515;
    color: #fff;
    padding: 10px 20px;
    border-radius: 5px;
    display: inline-block;
    font-size: 16px;
    font-weight: 600;
    transition: background-color 0.3s;
}

.btn.primary-btn:hover {
    background-color: #a01212;
    text-decoration: none;
}

/* Empty Cart Message Styling */
.empty-cart-message {
    text-align: center;
    font-size: 20px;
    color: #333;
    font-weight: 600;
    margin: 50px 0;
}

/* Additional Customizations */
.icon_close {
    font-size: 20px;
    color: #ca1515;
    cursor: pointer;
}

.icon_close:hover {
    color: #a01212;
}

.discount__content {
    display: flex;
    justify-content: center;
    align-items: center;
}

.cart__btn a {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    text-decoration: none;
    transition: color 0.3s;
}

.cart__btn a:hover {
    color: #ca1515;
}

.update__btn a {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    text-decoration: none;
    transition: color 0.3s;
}

.update__btn a:hover {
    color: #ca1515;
}

.offer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .offer-price {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .offer {
            font-weight: bold;
            padding: 5px;
            border-radius: 3px;
            text-align: center;
        }
        .offer-high {
            color: white;
            background-color: green; /* Color for category offer */
        }
        .offer-low {
            color: white;
            background-color: red; /* Color for product offer */
        }

        .cart__price {
            font-size: 16px;
        }
        .cart__price-muted {
            font-size: 14px;
            color: #999;
            text-decoration: line-through;
        }


        .shop-cart {
    padding: 40px 0;
    background-color: #f5f5f5;
}

.shop__cart__table .cart-container {
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    padding: 20px;
}

.cart-table {
    width: 100%;
    border-collapse: collapse;
}

.cart-table th,
.cart-table td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #dddddd;
}

.cart-table th {
    background-color: #007bff;
    color: white;
    font-weight: bold;
}

.cart-table .cart__product__item img {
    width: 50px;
    height: 70px;
    margin-right: 10px;
    border-radius: 4px;
}

.cart-table .cart__product__item__title {
    display: inline-block;
    vertical-align: top;
}

.cart-table .badge {
    display: inline-block;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 12px;
}

.cart-table .badge.in-stock {
    background-color: #28a745;
    color: white;
}

.cart-table .badge.out-stock {
    background-color: red;
    color: white;
}

.cart-table .cart__price-muted {
    color: #999999;
    text-decoration: line-through;
}

.cart-table .offer-price {
    font-weight: bold;
    color: #d9534f;
    background: linear-gradient(90deg, #ffd700, #ff8c00);
    padding: 8px;
    border-radius: 8px;
    text-align: center;
}

.cart-table .quantity-control {
    display: flex;
    justify-content: center;
    align-items: center;
}

.cart-table .value-button {
    background-color: #007bff;
    color: white;
    padding: 5px 10px;
    border: none;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    border-radius: 4px;
    margin: 0 5px;
}

.cart-table .total-price {
    font-size: 16px;
    color: #ca1515;
    font-weight: 600;
}

.empty-cart {
    text-align: center;
    padding: 50px 0;
}

.empty-cart h3 {
    font-size: 24px;
    font-weight: bold;
    color: #333333;
}








/* Shop Cart Section */
.shop-cart {
    padding: 30px 0;
    background-color: #f5f5f5; /* Light background color for the section */
}

/* Table styling */
.shop__cart__table table {
    width: 1300px%;
    border-collapse: collapse;
    background-color: #ffffff; /* White background for the table */
    border-radius: 8px; /* Rounded corners for the table */
    overflow: hidden; /* Ensures rounded corners on the table */
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
}

/* Shop Cart Table Header */
.shop__cart__table thead th {
    background-color: #f8f9fa; /* Light gray background */
    color: #333; /* Dark text for readability */
    padding: 12px 15px;
    text-align: left;
    border-bottom: 2px solid #dee2e6; /* Subtle border for separation */
    font-weight: bold;
    text-transform: uppercase; /* Uppercase for a clean look */
    border-radius: 4px; /* Slightly rounded corners for a modern touch */
}

.shop__cart__table thead th:hover {
    background-color: #e9ecef; /* Slightly darker gray for hover effect */
    border-bottom: 2px solid #adb5bd; /* Slightly darker border on hover */
    transition: background-color 0.3s, border-bottom 0.3s; /* Smooth transition */
}


.shop__cart__table thead th:hover {
    background: linear-gradient(145deg, #d01f71, #ee61b3); /* Reversed gradient on hover */
    border-bottom: 2px solid #ee61b3; /* Lighter border on hover */
    transition: background 0.3s, border-bottom 0.3s; /* Smooth transition */
}

.shop__cart__table tbody tr {
    border-bottom: 1px solid #ddd; /* Light gray border for rows */
}

.shop__cart__table tbody tr:nth-child(even) {
    background-color: #f9f9f9; /* Alternating row background color */
    width: max-content;
}

.shop__cart__table tbody td {
    padding: 12px 15px;
    vertical-align: middle; /* Center-align text vertically */
    font-size: 16px;
    color: #333; /* Dark text for readability */
}

.cart__price-muted {
    color: #1c1616; /* Muted price color */
    text-decoration: line-through; /* Strikethrough for original price */
}

.cart__price {
    color: #191414; /* Normal price color */
}

.offer-container {
    display: flex;
    flex-direction: column;
}

.offer-price {
    font-size: 16px;
    font-weight: bold;
    color: #d01f71; /* Highlighted color for offer price */
}

.category-offer {
    font-size: 14px;
    color: #f5f5f5; /* Subtle color for offer percentage */
    background-color: #dc0723;
    width: 70px;
}

.cart__quantity {
    text-align: center;
}

.value-button {
    background-color: #971684; /* Background color for quantity buttons */
    color: white;
    border: none;
    padding: 6px 12px;
    cursor: pointer;
    border-radius: 5px;
    font-size: 18px;
    transition: background-color 0.3s;
}

.value-button:hover {
    background-color: #991352; /* Darker shade on hover */
}

.prod_quantity {
    border: 1px solid #ddd;
    background-color: #ffffff;
    width: 65px;
    text-align: center;
    font-size: 16px;
}

.cart__close a {
    color: #ca1515; /* Color for delete icon */
    font-size: 20px;
}

.cart__close a:hover {
    color: #b20e0e; /* Darker color on hover */
}

/* Empty cart message */
.shop-cart h3 {
    color: #666; /* Gray color for empty cart message */
    font-size: 24px;
    font-weight: 600;
}











</style>


<!-- Breadcrumb Begin -->
<div class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__links">
                    <a href="{% url 'index' %}"><i class="fa fa-home"></i> Home</a>
                    <a href="{% url 'shop_cart' %}">Shopping Cart</a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb End -->
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script>
    {% if messages %}
    {% for message in messages %}
    {% if message.tags == 'error' %}
    swal("Error!", "{{ message }}", "error"); // Display error message with a warning icon
    {% elif message.tags == 'success' %}
    swal("Success!", "{{ message }}", "success"); // Display success message with a success icon
    {% else %}
    swal("Message", "{{ message }}"); // Display general message
    {% endif %}
    {% endfor %}
    {% endif %}
</script>


<!-- Shop Cart Section Begin -->
<section class="shop-cart spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="shop__cart__table">
                    {% if cart_items %}
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 5%;">Sl</th>
                                <th style="width: 35%;">Product</th>
                                <th style="width: 4%;">Size</th>
                                <th style="width: 15%;">Price</th>
                                <th style="width: 15%;">Offer Price</th>
                                <th style="width: 20%; padding-left: 50px;">Quantity</th>
                                <th style="width: 15%;">Total</th>
                                <th style="width: 15%;">Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in cart_item_offers %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td class="cart__product__item">
                                    <img style="width: 50px; height: 70px;" src="{{ item.item.product.image1.url }}" alt="">
                                    <div class="cart__product__item__title">
                                        <h6>{{ item.item.product.product.name }}</h6>
                                        {% if item.item.product.is_listed %}
                                        <span class="badge bg-success text-white rounded-pill px-2 py-1">In Stock</span>
                                        {% else %}
                                        <span class="badge text-white rounded-pill px-2 py-1" style="background-color: red;">Out of Stock</span>
                                        {% endif %}
                                    </div>
                                </td>
                                <td>{{ item.item.product_size }}</td>
                                <td>
                                    <h4 class="{% if item.item.product.product.offer_price and item.item.product.product.offer_price < item.item.product.product.price %}cart__price-muted{% else %}cart__price{% endif %}">
                                        ₹ {{ item.item.product.product.price }}
                                    </h4>
                                </td>
                                
                                <td>
                                    <div class="offer-container">
                                        <div class="offer-price">
                                            ₹{{ item.offer_price }}
                                        </div>
                                        {% if item.category_offer %}
                                        <div class="category-offer">
                                            {% if item.category_offer.discount_percentage > item.offer_percentage %}
                                            <strong> {{ item.category_offer.discount_percentage }}% Off</strong>
                                            {% else %}
                                            <strong> {{ item.offer_percentage }}% Off</strong>
                                            {% endif %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </td>

                                <td class="cart__quantity">
                                    <div class="d-flex align-items-center justify-content-center mb-3">
                                        <div class="value-button" id="decrease_{{ item.item.id }}"
                                            onclick="updateQuantity('decrease', '{{ item.item.id }}')">-</div>
                                        <input style="border: #000000; background-color: #ffffff; width: 65px;"
                                            type="text" id="number_{{ item.item.id }}"
                                            class="prod_quantity form-control text-center mx-2" name="quantity"
                                            value="{{ item.item.quantity }}" max="9" readonly>
                                        <div class="value-button" id="increase_{{ item.item.id }}"
                                            onclick="updateQuantity('increase', '{{ item.item.id }}')">+</div>
                                    </div>
                                </td>
                                <td>
                                    <span id="total_price_{{ item.item.id }}"
                                        style="font-size: 16px; color: #ca1515; font-weight: 600; width: 156px;">₹{{ item.total_price }}</span>
                                </td>
                                <td class="cart__close">
                                    <a href="{% url 'delete_cart_items' item.item.id %}">
                                        <span class="icon_close"></span>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <hr><br><br>
                    <div class="d-flex justify-content-center">
                        <h3>THERE IS NO PRODUCT IN CART</h3>
                    </div><br><br><hr><br><br>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

<!-- Shop Cart Section End -->
</div><br>
        <div class="row">
            <div class="col-lg-6">
                <div class="discount__content d-flex ">
                   
                </div>
            </div>
            <div class="col-lg-4 offset-lg-2">
                <div class="cart__total__procced">
                    <h6 class="text-center font">Cart total</h6><br>
                    <ul>
                        <li id="sub_total">Subtotal : <span>₹ {{ sub_total }}.00</span></li><br>
                       
                        <li>
                            {% if shipping_fee == 'Free' %}
                            Shipping fee :<span id="shipping_fee">{{ shipping_fee }}.00</span>
                            {% else %}
                            Shipping fee :<span id="shipping_fee">₹ {{ shipping_fee }}.00</span>
                            {% endif %}
                        </li><br>
                        <li id="total">Total :<span>₹ {{ total }}.00</span></li>
                        
                    </ul>
                    <a href="{% url 'checkout' %}" class="btn primary-btn">Proceed to checkout</a>
                </div>
            </div>
        </div>
    </div>
</section>






<!-- JavaScript to handle quantity update -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>


<script>
function updateQuantity(operation, cartItemId) {
    var quantityInputId = 'number_' + cartItemId;
    var totalPriceId = 'total_price_' + cartItemId;
    var quantityInput = document.getElementById(quantityInputId);
    var totalPriceElement = document.getElementById(totalPriceId);
    var currentQuantity = parseInt(quantityInput.value, 10);

    if (isNaN(currentQuantity)) {
        currentQuantity = 1; // Default to 1 if the current value is not a number
    }

    if (operation === 'increase' && currentQuantity < 9) {
        currentQuantity++;
    } else if (operation === 'decrease' && currentQuantity > 1) {
        currentQuantity--;
    }

    // Send AJAX request to update the total price and shipping fee
    $.ajax({
            url: "{% url 'update_total_price' %}",
            type: "POST",
            data: {
                'cart_item_id': cartItemId,
                'new_quantity': currentQuantity,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function (response) {
                if (response.new_total_price) {
                    // Update the total price and shipping fee in the HTML
                    quantityInput.value = currentQuantity;
                    totalPriceElement.textContent = '₹ ' + response.new_total_price;
                    document.querySelector('.cart__total__procced ul li:first-child span').textContent = '₹ ' + response.subtotal + '.0';
                    if (response.shipping_fee === 'Free') {
                        document.getElementById('shipping_fee').textContent = response.shipping_fee;
                    } else {
                        document.getElementById('shipping_fee').textContent = '₹ ' + response.shipping_fee + '.0';
                    }
                    document.querySelector('.cart__total__procced ul li:last-child span').textContent = '₹ ' + response.total + '.0';
                } else {
                    totalPriceElement.textContent = '₹ 0.0';
                }
            },
            error: function (xhr) {
                if (xhr.status === 400) {
                    swal("Error!", xhr.responseJSON.error, "error"); 
                    if (xhr.responseJSON.error.includes("There is only")) {
                        var availableQuantity = parseInt(xhr.responseJSON.error.match(/\d+/)[0], 10);
                        quantityInput.value = availableQuantity; // Set the quantity input to the available quantity
                    }
                } else {
                    alert('Error updating total price: ' + xhr.statusText);
                }
            }
        });
    }
    </script>




<script>
    // Add an event listener to the button
    document.getElementById('showAvailableCouponBtn').addEventListener('click', function () {
        // Open the modal when the button is clicked
        var myModal = new bootstrap.Modal(document.getElementById('exampleModal'), {
            keyboard: false
        });
        myModal.show();
    });
</script>




{% endblock content %}